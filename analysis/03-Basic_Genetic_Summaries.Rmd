---
output: html_document
editor_options: 
  chunk_output_type: console
---
# Genetic Pairwise & Geographic Summaries
Let's look at pairwise comparison of the identity by state and identity by descent of all of our samples. We will look at them with respect to Province just for some sembalance of "space". 

```{r}
source("R/basics.R")
source("R/pairwise_helpers.R")
source("R/themes.R")
library(tidyverse)
# drc prov for plot
DRCprov <- sf::st_as_sf(readRDS("data/map_bases/gadm/gadm36_COD_1_sp.rds"))

#....................................................................................
# Import Genetic Data
#....................................................................................
ibD <- readRDS("data/derived_data/bigbarcode_genetic_data/mipanalyzer.DRCibD.long.mtdt.rds")
ibS <- readRDS("data/derived_data/bigbarcode_genetic_data/mipanalyzer.DRCibS.long.mtdt.rds")

```


## Pairwise IBS
```{r}
#.....................
# EDA of Our Genetic Data
# for IBS
#.....................
# Pairwise Comparisons
ibS.exp.hv001 <- expand_distance_matrix(ibS)

pairwiseibS.plotObj <- ibS.exp.hv001 %>%
  dplyr::mutate(smpl1 = forcats::fct_rev(forcats::fct_reorder(.f = smpl1, .x = adm1name.x, .fun = length)),
                smpl2 = forcats::fct_rev(forcats::fct_reorder(.f = smpl2, .x = adm1name.y, .fun = length))) %>%
  ggplot() +
  geom_tile(aes(x=smpl1, y=smpl2, fill = hammings)) +
  ggtitle("Pairwise Identity by State") +
  scale_fill_viridis_c("Ihat") +
  plot_theme +
  theme(axis.text = element_blank())

```

```{r, results='asis', fig.width=11, fig.height=8, fig.align='center'}
plot(pairwiseibS.plotObj)
```


### Pairwise IBS Stats {.tabset .tabset-pills}

#### Prov
```{r, results='asis'}
ibS.exp.hv001 %>% # selfs already excluded
    summ_var(., x = "hammings", groupingvar = "adm1name.x") %>% 
  pretty_DT_tab(.)

```


#### Cluster
```{r, results='asis'}
ibS.exp.hv001 %>% # selfs already excluded
    summ_var(., x = "hammings", groupingvar = "hv001.x") %>% 
  pretty_DT_tab(.)

```

#### Sample
```{r, results='asis'}
ibS.exp.hv001 %>% # selfs already excluded
  summ_var(., x = "hammings", groupingvar = "smpl1") %>% 
  pretty_DT_tab(.)

```

### {-}


## Pairwise IBD {.tabset .tabset-pills}
```{r}
#.....................
# EDA of Our Genetic Data
# for IBD
#.....................
# Pairwise Comparisons
ibD.exp.hv001 <- expand_distance_matrix(ibD)

pairwiseibD.plotObj <- ibD.exp.hv001 %>%
  dplyr::mutate(smpl1 = forcats::fct_rev(forcats::fct_reorder(.f = smpl1, .x = adm1name.x, .fun = length)),
                smpl2 = forcats::fct_rev(forcats::fct_reorder(.f = smpl2, .x = adm1name.y, .fun = length))) %>%
  ggplot() +
  geom_tile(aes(x=smpl1, y=smpl2, fill = malecotf)) +
  ggtitle("Pairwise Identity by Descent") +
  scale_fill_viridis_c("Fhat") +
  plot_theme +
  theme(axis.text = element_blank())

```

```{r, results='asis', fig.width=11, fig.height=8, fig.align='center'}
plot(pairwiseibD.plotObj)
```



### Pairwise IBD Stats
#### Prov
```{r, results='asis'}
ibD.exp.hv001 %>% # selfs already excluded
  summ_var(., x = "malecotf", groupingvar = "adm1name.x") %>% 
  pretty_DT_tab(.)

```


#### Cluster
```{r, results='asis'}
ibD.exp.hv001 %>% # selfs already excluded
   summ_var(., x = "malecotf", groupingvar = "hv001.x") %>% 
  pretty_DT_tab(.)

```

#### Sample
```{r, results='asis'}
ibD.exp.hv001 %>% # selfs already excluded
   summ_var(., x = "malecotf", groupingvar = "smpl1") %>% 
  pretty_DT_tab(.)

```

### {-}
